# Ground Rod ERP - Integrated Workflow Diagrams

## ğŸ”„ Complete Material & Inventory Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     VENDOR PURCHASE ORDER                           â”‚
â”‚                                                                     â”‚
â”‚  Create VPO â†’ Receive Materials â†’ raw_materials_inventory â†‘        â”‚
â”‚                                    (Steel: +5000kg, Copper: +500kg) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ Materials Available
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PRODUCTION PROCESS                               â”‚
â”‚                                                                     â”‚
â”‚  Log Production (Packed: 1000 units)                                â”‚
â”‚         â”‚                                                           â”‚
â”‚         â”œâ”€â”€â†’ Check BOM (14mm rod needs: 3.5kg steel, 0.25kg copper)â”‚
â”‚         â”‚                                                           â”‚
â”‚         â”œâ”€â”€â†’ Calculate Total (1000 Ã— 3.5kg = 3500kg steel)         â”‚
â”‚         â”‚                    (1000 Ã— 0.25kg = 250kg copper)         â”‚
â”‚         â”‚                                                           â”‚
â”‚         â”œâ”€â”€â†’ Deduct from raw_materials_inventory                   â”‚
â”‚         â”‚    (Steel: 5000kg â†’ 1500kg)                              â”‚
â”‚         â”‚    (Copper: 500kg â†’ 250kg)                               â”‚
â”‚         â”‚                                                           â”‚
â”‚         â””â”€â”€â†’ Add to inventory.packed (+1000)                       â”‚
â”‚                                                                     â”‚
â”‚  ğŸ“Š Audit Log: Material consumption recorded                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ Finished Goods Available
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CLIENT PURCHASE ORDER                           â”‚
â”‚                                                                     â”‚
â”‚  Create PO (Qty: 1000)                                              â”‚
â”‚         â”‚                                                           â”‚
â”‚         â”œâ”€â”€â†’ Check availability (Packed: 1500, Committed: 0)       â”‚
â”‚         â”‚    Available: 1500 âœ“                                     â”‚
â”‚         â”‚                                                           â”‚
â”‚         â”œâ”€â”€â†’ Commit inventory                                      â”‚
â”‚         â”‚    (Committed: 0 â†’ 1000)                                 â”‚
â”‚         â”‚    (Available: 1500 â†’ 500)                               â”‚
â”‚         â”‚                                                           â”‚
â”‚         â””â”€â”€â†’ PO Status: Pending                                    â”‚
â”‚                                                                     â”‚
â”‚  ğŸ“Š Audit Log: PO created, inventory committed                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ Order Ready to Ship
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SHIPMENT PROCESS                                 â”‚
â”‚                                                                     â”‚
â”‚  Create Shipment (Qty: 1000)                                        â”‚
â”‚         â”‚                                                           â”‚
â”‚         â”œâ”€â”€â†’ Update PO line item                                   â”‚
â”‚         â”‚    (Delivered: 0 â†’ 1000)                                 â”‚
â”‚         â”‚                                                           â”‚
â”‚         â”œâ”€â”€â†’ Deduct from inventory.packed                          â”‚
â”‚         â”‚    (Packed: 1500 â†’ 500)                                  â”‚
â”‚         â”‚                                                           â”‚
â”‚         â”œâ”€â”€â†’ Uncommit inventory                                    â”‚
â”‚         â”‚    (Committed: 1000 â†’ 0)                                 â”‚
â”‚         â”‚    (Available: 500 â†’ 500)                                â”‚
â”‚         â”‚                                                           â”‚
â”‚         â””â”€â”€â†’ PO Status: Completed (if fully delivered)             â”‚
â”‚                                                                     â”‚
â”‚  ğŸ“Š Audit Log: Shipment created, fulfillment complete               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Inventory State Transitions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Raw Steel   â”‚
â”‚   5000 kg    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Receive from Vendor
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  raw_materials_inventory             â”‚
â”‚  Steel: 5000kg â†’ 1500kg (-3500)     â”‚
â”‚  Copper: 500kg â†’ 250kg (-250)       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Production (BOM-based deduction)
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Inventory (Product: CBG-14-3000)    â”‚
â”‚                                      â”‚
â”‚  Cores:     100                      â”‚
â”‚  Plated:    200                      â”‚
â”‚  Machined:  150                      â”‚
â”‚  QC:        100                      â”‚
â”‚  Stamped:   50                       â”‚
â”‚  Packed:    1500 â”€â”€â”                 â”‚
â”‚  Committed: 0      â”‚                 â”‚
â”‚  Available: 1500   â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ Client PO Created
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Inventory (After PO)                â”‚
â”‚                                      â”‚
â”‚  Packed:    1500 (unchanged)         â”‚
â”‚  Committed: 1000 (+1000) â—„â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  Available: 500  (-1000)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ Shipment Created
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Inventory (After Shipment)          â”‚
â”‚                                      â”‚
â”‚  Packed:    500  (-1000)             â”‚
â”‚  Committed: 0    (-1000)             â”‚
â”‚  Available: 500  (unchanged)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âŒâ¡ï¸âœ… Error Correction Flow (Soft Delete + Undo)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USER ACTION: Delete PO accidentally                       â”‚
â”‚                                                            â”‚
â”‚  DELETE /api/purchase-orders/PO-001                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SYSTEM RESPONSE: Soft Delete                              â”‚
â”‚                                                            â”‚
â”‚  1. Set is_deleted = 1                                     â”‚
â”‚  2. Uncommit inventory (Committed: 1000 â†’ 0)               â”‚
â”‚  3. Update available (Available: 500 â†’ 1500)               â”‚
â”‚  4. Log audit trail (Action: SOFT_DELETE)                  â”‚
â”‚  5. Return: { "can_undo": true }                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ User realizes mistake within minutes
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USER ACTION: Undo the deletion                            â”‚
â”‚                                                            â”‚
â”‚  POST /api/undo/client_purchase_orders/PO-001              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SYSTEM RESPONSE: Restore                                  â”‚
â”‚                                                            â”‚
â”‚  1. Verify is_deleted = 1 âœ“                                â”‚
â”‚  2. Set is_deleted = 0                                     â”‚
â”‚  3. Recommit inventory (Committed: 0 â†’ 1000)               â”‚
â”‚  4. Update available (Available: 1500 â†’ 500)               â”‚
â”‚  5. Log audit trail (Action: RESTORE)                      â”‚
â”‚  6. Return: { "message": "Record restored successfully" }  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
           âœ… PO FULLY RESTORED
        (All inventory states back to normal)
```

---

## ğŸ” Availability Check Flow (Pre-Flight Validation)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USER: Creating New Client PO               â”‚
â”‚  Wants to order 2000 units of CBG-14-3000   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ Before submitting PO
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FRONTEND: Call availability check                      â”‚
â”‚                                                         â”‚
â”‚  POST /api/inventory/check-availability                â”‚
â”‚  {                                                      â”‚
â”‚    "line_items": [                                      â”‚
â”‚      { "product_id": "CBG-14-3000", "quantity": 2000 }  â”‚
â”‚    ]                                                    â”‚
â”‚  }                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BACKEND: Query inventory                               â”‚
â”‚                                                         â”‚
â”‚  Current State:                                         â”‚
â”‚  - Packed: 1500                                         â”‚
â”‚  - Committed: 500                                       â”‚
â”‚  - Available: 1000                                      â”‚
â”‚                                                         â”‚
â”‚  Requested: 2000                                        â”‚
â”‚  Available: 1000                                        â”‚
â”‚  Shortfall: 1000 âŒ                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RESPONSE: Insufficient Inventory                       â”‚
â”‚                                                         â”‚
â”‚  {                                                      â”‚
â”‚    "available": false,                                  â”‚
â”‚    "details": [{                                        â”‚
â”‚      "product_id": "CBG-14-3000",                       â”‚
â”‚      "requested": 2000,                                 â”‚
â”‚      "available": 1000,                                 â”‚
â”‚      "sufficient": false,                               â”‚
â”‚      "shortfall": 1000                                  â”‚
â”‚    }],                                                  â”‚
â”‚    "warnings": [                                        â”‚
â”‚      "CBG-14-3000: Need 2000, only 1000 available       â”‚
â”‚       (shortfall: 1000)"                                â”‚
â”‚    ]                                                    â”‚
â”‚  }                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FRONTEND: Show warning to user             â”‚
â”‚                                             â”‚
â”‚  âš ï¸ Insufficient Inventory Alert            â”‚
â”‚                                             â”‚
â”‚  Cannot fulfill this order completely:      â”‚
â”‚  â€¢ Requested: 2000 units                    â”‚
â”‚  â€¢ Available: 1000 units                    â”‚
â”‚  â€¢ Shortfall: 1000 units                    â”‚
â”‚                                             â”‚
â”‚  Options:                                   â”‚
â”‚  1. Reduce quantity to 1000                 â”‚
â”‚  2. Schedule production for remaining 1000  â”‚
â”‚  3. Cancel order                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Document Attachment Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USER: Uploads Invoice PDF to PO       â”‚
â”‚                                        â”‚
â”‚  File: invoice_2025_001.pdf (2.5 MB)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BACKEND: Process upload                           â”‚
â”‚                                                    â”‚
â”‚  1. Validate: entity_type = "client_po" âœ“          â”‚
â”‚  2. Create directory: uploads/attachments/         â”‚
â”‚     client_po/PO-2025-001/                         â”‚
â”‚  3. Generate filename: 1737897600_invoice.pdf      â”‚
â”‚  4. Save file to disk                              â”‚
â”‚  5. Insert record to document_attachments:         â”‚
â”‚     - entity_type: client_po                       â”‚
â”‚     - entity_id: PO-2025-001                       â”‚
â”‚     - file_name: invoice_2025_001.pdf              â”‚
â”‚     - file_path: uploads/attachments/...           â”‚
â”‚     - file_size: 2621440 (bytes)                   â”‚
â”‚     - mime_type: application/pdf                   â”‚
â”‚  6. Log audit trail                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STORAGE: File persisted                â”‚
â”‚                                        â”‚
â”‚  uploads/                              â”‚
â”‚  â””â”€â”€ attachments/                      â”‚
â”‚      â””â”€â”€ client_po/                    â”‚
â”‚          â””â”€â”€ PO-2025-001/              â”‚
â”‚              â”œâ”€â”€ 1737897600_invoice.pdfâ”‚
â”‚              â””â”€â”€ 1737898200_contract.pdfâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ Later: User wants to view
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GET /api/attachments/client_po/       â”‚
â”‚      PO-2025-001                       â”‚
â”‚                                        â”‚
â”‚  Response: [                           â”‚
â”‚    {                                   â”‚
â”‚      "id": 42,                         â”‚
â”‚      "file_name": "invoice_2025_001.pdf"â”‚
â”‚      "file_size": 2621440,             â”‚
â”‚      "uploaded_at": "2025-01-26..."    â”‚
â”‚    },                                  â”‚
â”‚    { ... }                             â”‚
â”‚  ]                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ User clicks download
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GET /api/attachments/download/42      â”‚
â”‚                                        â”‚
â”‚  â†’ Sends file with correct headers     â”‚
â”‚  â†’ Browser downloads: invoice_2025...pdfâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ• Audit Trail Timeline

```
Time: 10:00 AM
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Event: Client PO Created              â”‚
â”‚  Action: CREATE                        â”‚
â”‚  Table: client_purchase_orders         â”‚
â”‚  Record: PO-2025-001                   â”‚
â”‚  User: system                          â”‚
â”‚  New Values: { customer_id, po_date... }â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
Time: 10:05 AM
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Event: Production Logged              â”‚
â”‚  Action: CREATE                        â”‚
â”‚  Table: production_history             â”‚
â”‚  Record: 123                           â”‚
â”‚  User: system                          â”‚
â”‚  New Values: { product_id, packed... }  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
Time: 10:07 AM
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Event: Material Consumed              â”‚
â”‚  Action: CONSUMED                      â”‚
â”‚  Table: raw_materials_inventory        â”‚
â”‚  Record: Steel Rod 14mm                â”‚
â”‚  User: system                          â”‚
â”‚  New Values: { quantity: 3500 }        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
Time: 2:30 PM
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Event: PO Accidentally Deleted        â”‚
â”‚  Action: SOFT_DELETE                   â”‚
â”‚  Table: client_purchase_orders         â”‚
â”‚  Record: PO-2025-001                   â”‚
â”‚  User: system                          â”‚
â”‚  Old Values: { entire PO object }      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
Time: 2:32 PM
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Event: Deletion Undone                â”‚
â”‚  Action: RESTORE                       â”‚
â”‚  Table: client_purchase_orders         â”‚
â”‚  Record: PO-2025-001                   â”‚
â”‚  User: system                          â”‚
â”‚  New Values: { entire PO object }      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
Time: 3:00 PM
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Event: Shipment Created               â”‚
â”‚  Action: CREATE                        â”‚
â”‚  Table: shipments                      â”‚
â”‚  Record: SHIP-2025-050                 â”‚
â”‚  User: system                          â”‚
â”‚  New Values: { po_id, shipment_date... }â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… Complete Timeline Available
   GET /api/audit-log/client_purchase_orders/PO-2025-001
   â†’ Returns all 4 events in chronological order
```

---

## ğŸ“Š Dashboard Data Dependencies

```
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚   DASHBOARD     â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                â”‚                â”‚
              â†“                â†“                â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Total WIP      â”‚  â”‚ Finished â”‚  â”‚ Pending      â”‚
    â”‚                 â”‚  â”‚  Goods   â”‚  â”‚  Orders      â”‚
    â”‚  SUM(plated +   â”‚  â”‚          â”‚  â”‚              â”‚
    â”‚  machined +     â”‚  â”‚ SUM(     â”‚  â”‚ COUNT(*)     â”‚
    â”‚  qc + stamped)  â”‚  â”‚  packed) â”‚  â”‚ WHERE        â”‚
    â”‚                 â”‚  â”‚          â”‚  â”‚ status=      â”‚
    â”‚  FROM inventory â”‚  â”‚ FROM     â”‚  â”‚ 'Pending'    â”‚
    â”‚                 â”‚  â”‚ inventoryâ”‚  â”‚              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                â”‚                â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Material Risk       â”‚
                    â”‚  Analysis            â”‚
                    â”‚                      â”‚
                    â”‚  For each pending PO:â”‚
                    â”‚  1. Get line items   â”‚
                    â”‚  2. Get BOM          â”‚
                    â”‚  3. Calculate need   â”‚
                    â”‚  4. Compare to       â”‚
                    â”‚     raw_materials    â”‚
                    â”‚  5. Show shortage    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Quick Reference**: All flows are automatic - no manual intervention needed!

